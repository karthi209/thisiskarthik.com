<!doctype html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="{{.BasePath}}favicon.svg" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0, viewport-fit=cover" />
  <meta name="description" content="Hmm... Blog? - A personal blog by Karthik" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)" />
  <meta name="color-scheme" content="light dark" />
  <!-- Local fonts - IM Fell Great Primer loaded from {{.BasePath}}fonts/ directory -->
  <!-- Preload fonts to prevent FOUT (Flash of Unstyled Text) -->
  <link rel="preload" as="font" href="{{.BasePath}}fonts/IMFellGreatPrimer-Regular.woff2" type="font/woff2"
    crossorigin="anonymous">

  <!-- Preload brand image to prevent layout shifts -->
  {{if ne .PageType "post"}}
  <link rel="preload" as="image" href="{{.BasePath}}images/home.webp" fetchpriority="high">
  {{end}}
  <link rel="stylesheet" href="{{.BasePath}}css/style.css">
  <title>{{if .Title}}{{.Title}} - {{end}}Hmm... Blog?</title>
  <script>
    // Set theme before page renders to prevent flash - light is always default
    (function() {
      const savedTheme = localStorage.getItem('theme');
      // Only use saved theme if it's explicitly 'dark', otherwise default to 'light'
      const theme = savedTheme === 'dark' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', theme);
      // Ensure it's persisted
      if (savedTheme) {
        localStorage.setItem('theme', savedTheme);
      } else {
        localStorage.setItem('theme', 'light');
      }
      
      // Switch images based on theme
      function switchImages(theme) {
        const images = document.querySelectorAll('img[data-theme-image]');
        images.forEach(img => {
          const baseSrc = img.getAttribute('data-theme-image');
          if (theme === 'dark') {
            // Replace .webp with _dark.webp
            const darkSrc = baseSrc.replace('.webp', '_dark.webp');
            img.src = darkSrc;
          } else {
            // Use base image
            img.src = baseSrc;
          }
        });
        
      }
      
      // Switch images on initial load
      switchImages(theme);
    })();
  </script>
</head>

<body>
  <div class="site-container" data-page="{{.PageType}}">
    <main class="main-content">
      <div class="home-layout">
        <div class="home-main">
          {{block "content" .}}<p>No content defined</p>{{end}}
        </div>
      </div>
    </main>
    {{template "footer" .}}
  </div>
</body>

</html>

{{define "footer"}}
<footer class="footer">
  <div class="footer-container">
    <div class="hero-decorative-divider">
      <img src="{{.BasePath}}images/divider.webp" data-theme-image="{{.BasePath}}images/divider.webp" alt="" class="hero-decorative-element" width="438" height="76"
        loading="lazy" decoding="async" />
    </div>
    <p class="footer-closing">That's the end of this page.</p>
    <nav class="footer-nav">
      <a href="{{.BasePath}}index">Index</a>
      <span class="footer-separator">·</span>
      <a href="{{.BasePath}}meta">Meta</a>
      <span class="footer-separator">·</span>
      <a href="{{.BasePath}}rss.xml" target="_blank" rel="noreferrer">RSS</a>
      <span class="footer-separator">·</span>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <span class="theme-toggle-icon">
          <span class="theme-icon-moon"></span>
          <span class="theme-icon-sun"></span>
        </span>
      </button>
    </nav>
  </div>
</footer>
<script>
  (function() {
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return; // Safety check
    
    const moonIcon = themeToggle.querySelector('.theme-icon-moon');
    const sunIcon = themeToggle.querySelector('.theme-icon-sun');
    
    function switchImages(theme) {
      const images = document.querySelectorAll('img[data-theme-image]');
      images.forEach(img => {
        const baseSrc = img.getAttribute('data-theme-image');
        if (theme === 'dark') {
          // Replace .webp with _dark.webp
          img.src = baseSrc.replace('.webp', '_dark.webp');
        } else {
          // Use base image
          img.src = baseSrc;
        }
      });
    }
    
    function updateTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      // Show moon in light mode, sun in dark mode
      if (moonIcon && sunIcon) {
        if (theme === 'dark') {
          moonIcon.style.display = 'none';
          sunIcon.style.display = 'inline-block';
        } else {
          moonIcon.style.display = 'inline-block';
          sunIcon.style.display = 'none';
        }
      }
      // Switch images when theme changes
      switchImages(theme);
    }
    
    function getCurrentTheme() {
      // Always read from localStorage first to ensure consistency
      const savedTheme = localStorage.getItem('theme');
      // Always default to light if not explicitly set to dark
      return savedTheme === 'dark' ? 'dark' : 'light';
    }
    
    // Initialize icon visibility on page load
    const savedTheme = getCurrentTheme();
    updateTheme(savedTheme);
    
    // Sync theme from localStorage on page load (in case it changed)
    const currentTheme = getCurrentTheme();
    if (moonIcon && sunIcon) {
      if (currentTheme === 'dark') {
        moonIcon.style.display = 'none';
        sunIcon.style.display = 'inline-block';
      } else {
        moonIcon.style.display = 'inline-block';
        sunIcon.style.display = 'none';
      }
    }
    
    // Set up toggle click handler
    themeToggle.addEventListener('click', function() {
      const currentTheme = getCurrentTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      updateTheme(newTheme);
    });
  })();
</script>
{{end}}